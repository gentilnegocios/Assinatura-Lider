<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- FAVICON -->
    <link
      rel="icon"
      href="https://github.com/gentilnegocios/Assinatura-Lider/blob/main/_img/favicon-tex.png"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="style.css" rel="stylesheet" />

    <title>Assinatura - Gentil Negócios</title>
  </head>
  <body>
    <section id="lider">
      <div class="container">
        <div class="row">
          <form>
            <div class="form-group col">
              <div class="col-auto">
                <label for="nomelider">Nome do líder</label>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Nome e Sobrenome"
                  id="nomelider"
                  required
                />
              </div>
            </div>

            <div class="form-group col">
              <div class="col-auto">
                <label for="cargolider">Cargo</label>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Digite o seu cargo"
                  id="cargolider"
                  required
                />
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label for="telefonelider">Celular (Opcional)</label>
                <input
                  type="tel"
                  class="form-control"
                  placeholder="(XX) XXXXX-XXXX"
                  id="telefonelider"
                  maxlength="15"
                />
              </div>
            </div>
          </form>

          <!-- Canvas e imagem de visualização -->
          <canvas class="img-fluid" id="clider"></canvas>
          <a id="link" target="new_blank"></a>
          <div id="toggle" class="signature">
            <img
              crossorigin="anonymous"
              class="img-fluid"
              id="assinaturaTemplatelider"
              style="margin-top: 2%"
            />
          </div>

          <button type="submit" onclick="saveImagelider()" class="btn-download">
            Baixar Assinatura
          </button>
        </div>
      </div>
    </section>

    <div class="fixed-icons">
      <a href="https://central.gentilnegocios.com.br/" target="_blank"
        ><img
          src="https://raw.githubusercontent.com/gentilnegocios/Assinatura/refs/heads/main/_img/logo-tex.png"
          alt="tex"
      /></a>
      <a href="https://gptw.com.br/" target="_blank"
        ><img
          src="https://raw.githubusercontent.com/gentilnegocios/Assinatura/f5a4b3290de82a116bc0f8ffcce5e286feb6e084/_img/gptw.svg"
          alt="GPTW"
      /></a>
    </div>

    <!-- Bootstrap Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>

    <!-- SCRIPT -->
    <script type="text/javascript">
      const ctx2 = clider.getContext("2d");
      const assinatura_customlider = new Image();

      assinatura_customlider.onload = () => {
        clider.width = 1080;
        clider.height = 257;
        renderlider();
      };

      assinatura_customlider.crossOrigin = "anonymous";
      assinatura_customlider.src = "assinatura.png";

      nomelider.oninput =
        cargolider.oninput =
        telefonelider.oninput =
          renderlider;

      function renderlider() {
        const { nomelider, cargolider, telefonelider } = getFormDatalider();
        setInitialImagelider();
        setTextlider(nomelider, cargolider, telefonelider);
        setImagelider();
      }

      function getFormDatalider() {
        return {
          nomelider: document.getElementById("nomelider").value,
          cargolider: document.getElementById("cargolider").value,
          telefonelider: document.getElementById("telefonelider").value,
        };
      }

      function setInitialImagelider() {
        ctx2.clearRect(0, 0, clider.width, clider.height);
        ctx2.globalCompositeOperation = "source-over";
        ctx2.drawImage(assinatura_customlider, 0, 0, clider.width, clider.height);
      }

      function setImagelider() {
        const assinatura = document.getElementById("assinaturaTemplatelider");
        assinatura.src = clider.toDataURL();
        clider.style.display = "none";
      }

      function setCliplider() {
        ctx2.globalCompositeOperation = "destination-in";
        ctx2.globalCompositeOperation = "source-over";
        ctx2.font = "bolder 25px Montserrat, sans-serif";
        ctx2.textAlign = "left";
        ctx2.fillStyle = "white";
      }

      function setTextlider(nome, cargo, telefone) {
        setCliplider();
        ctx2.textBaseline = "hanging";
        ctx2.fillText(nome, 142, 62);
        setCargolider(cargo);
        setTelefoneLider(telefone);
      }

      function setCargolider(cargo) {
        ctx2.globalCompositeOperation = "destination-in";
        ctx2.globalCompositeOperation = "source-over";
        ctx2.font = "25px Montserrat, sans-serif";
        ctx2.textAlign = "left";
        ctx2.fillStyle = "white";
        ctx2.textBaseline = "hanging";
        ctx2.fillText(cargo, 142, 100);
      }

      function setTelefoneLider(telefone) {
        if (!telefone.trim()) return;

        ctx2.globalCompositeOperation = "destination-in";
        ctx2.globalCompositeOperation = "source-over";
        ctx2.font = "13px Montserrat, sans-serif";
        ctx2.textAlign = "left";
        ctx2.fillStyle = "white";
        ctx2.textBaseline = "hanging";

        let numeros = telefone.replace(/\D/g, "");

        if (numeros.length === 10) {
          numeros = numeros.slice(0, 2) + "9" + numeros.slice(2);
        }

        const numeroCompletado = numeros.padEnd(11, "_");

        const formatado = numeroCompletado.replace(
          /^(\d{2}|__)(\d{5}|_____)(\d{4}|____)/,
          "($1) $2-$3"
        );

        ctx2.fillText(formatado, 240, 143);
      }

      function saveImagelider() {
        let link = document.getElementById("link");
        link.setAttribute("download", "assinatura.png");
        link.setAttribute(
          "href",
          clider.toDataURL().replace("image/png", "image/octet-stream")
        );
        link.click();
      }
    </script>
  </body>
</html>
